# 📞 AI Voice Assistant - SIP/RTP System

## 🚀 Обновление системы

**Полностью переработана архитектура:**
- ❌ **Удалено**: Все веб-компоненты (Flask, webhooks, WebRTC, WebPhone)
- ✅ **Добавлено**: Прямая SIP/RTP интеграция для перехвата телефонных звонков
- ✅ **Реализовано**: AI обработка голосовых запросов через телефонию без веб-интерфейса

## 📋 Описание

Система AI голосового ассистента, которая:
- Принимает входящие телефонные звонки через SIP протокол
- Обрабатывает голос абонента в реальном времени через RTP
- Использует AI для генерации ответов
- Преобразует ответы обратно в речь
- Работает как полноценная телефонная система без веб-интерфейса

## 🏗️ Архитектура

```
┌─────────────┐     SIP      ┌──────────────┐     Audio      ┌──────────────┐
│   IP Phone  ├─────────────►│  SIP Server  ├───────────────►│ AI Processor │
│   (Caller)  │◄─────────────┤  (Port 5060) │◄───────────────┤   (Whisper)  │
└─────────────┘     RTP      └──────────────┘                └──────────────┘
                                     │                               │
                                     │                               ▼
                              ┌──────▼───────┐              ┌────────────────┐
                              │ RTP Handler  │              │  OpenAI GPT    │
                              │(Ports 10000+)│              │  (AI Responses)│
                              └──────────────┘              └────────────────┘
```

## 📁 Структура проекта

```
.
├── sip_server.py           # Основной SIP сервер
├── sip_voice_ai_engine.py  # AI движок для обработки запросов
├── sip_speech_processor.py # Преобразование речь↔текст
├── requirements.txt        # Python зависимости
├── install_sip_dependencies.sh  # Установка системных пакетов
├── start_sip_system.sh     # Запуск системы
├── stop_sip_system.sh      # Остановка системы
└── README.md              # Этот файл
```

## 🛠️ Установка

### 1. Системные требования

- Ubuntu/Debian Linux (тестировалось на Ubuntu 20.04+)
- Python 3.8+
- Минимум 4GB RAM (для AI моделей)
- Открытые порты: 5060 (SIP), 10000-10100 (RTP)

### 2. Установка зависимостей

```bash
# Сделать скрипт исполняемым
chmod +x install_sip_dependencies.sh

# Запустить установку
./install_sip_dependencies.sh
```

### 3. Настройка переменных окружения

Создайте файл `.env`:

```bash
# OpenAI API ключ для генерации ответов
OPENAI_API_KEY=your_openai_api_key_here

# Опционально: настройки SIP
SIP_PORT=5060
RTP_START_PORT=10000
```

## 🚀 Запуск системы

### Автоматический запуск (через скрипт):

```bash
# Сделать скрипт исполняемым
chmod +x start_sip_system.sh

# Запустить с автоопределением IP
./start_sip_system.sh

# Или указать конкретный IP и порт
./start_sip_system.sh 192.168.1.100 5060
```

### Ручной запуск:

```bash
# Запуск SIP сервера
python3 sip_server.py [IP_адрес] [SIP_порт]

# Примеры:
python3 sip_server.py                    # Использует 0.0.0.0:5060
python3 sip_server.py 192.168.1.100      # Использует указанный IP и порт 5060
python3 sip_server.py 192.168.1.100 5070 # Использует указанный IP и порт
```

## 🛑 Остановка системы

### Через скрипт:

```bash
./stop_sip_system.sh
```

### Вручную:

```bash
# Найти процесс
ps aux | grep sip_server.py

# Остановить процесс
kill <PID>
```

## 📞 Настройка SIP клиента

Для тестирования используйте любой SIP клиент (Zoiper, Linphone, X-Lite):

- **Server/Domain**: IP адрес вашего сервера
- **Port**: 5060 (или указанный при запуске)
- **Username**: ai (или любой)
- **Password**: не требуется
- **Transport**: UDP

## 🧪 Тестирование

1. Запустите систему
2. Настройте SIP клиент
3. Позвоните на SIP сервер
4. Говорите после соединения
5. AI обработает ваш запрос и ответит голосом

## 📊 Мониторинг

### Просмотр логов:

```bash
# В реальном времени
tail -f logs/sip_server.log

# Последние 100 строк
tail -n 100 logs/sip_server.log

# Поиск ошибок
grep ERROR logs/sip_server.log
```

### Проверка портов:

```bash
# Проверить, что SIP порт открыт
netstat -tuln | grep 5060

# Проверить RTP порты
netstat -tuln | grep 1000
```

## 🔧 Решение проблем

### SIP сервер не запускается:

```bash
# Проверить, не занят ли порт
sudo lsof -i :5060

# Убить процесс, занимающий порт
sudo kill -9 <PID>
```

### Нет звука:

1. Проверьте файрвол - откройте RTP порты 10000-10100
2. Проверьте NAT настройки если сервер за роутером
3. Убедитесь что аудио кодеки совпадают (PCMU/PCMA)

### AI не отвечает:

1. Проверьте OPENAI_API_KEY в .env файле
2. Проверьте интернет соединение
3. Смотрите логи на наличие ошибок API

## 🔐 Безопасность

⚠️ **Важно**: Текущая версия НЕ включает аутентификацию SIP!

Для production использования:
1. Добавьте SIP аутентификацию (digest authentication)
2. Используйте TLS для SIP (SIPS)
3. Настройте файрвол - разрешите только нужные IP
4. Используйте SRTP для шифрования аудио

## 📝 Лицензия

MIT License

## 🤝 Поддержка

При возникновении проблем:
1. Проверьте логи в папке `logs/`
2. Убедитесь что все зависимости установлены
3. Проверьте сетевые настройки и порты

---

**Примечание**: Это демонстрационная версия. Для production использования требуется дополнительная настройка безопасности и оптимизация.