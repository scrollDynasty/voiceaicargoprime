# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Voice AI —Å RingCentral

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –∑–≤–æ–Ω–∏—Ç –Ω–∞ –≤–∞—à –Ω–æ–º–µ—Ä RingCentral, –∑–≤–æ–Ω–æ–∫ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≤–∞—à—É –ª–æ–∫–∞–ª—å–Ω—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å —á–µ—Ä–µ–∑ SIP –ø—Ä–æ—Ç–æ–∫–æ–ª. –í–æ—Ç —Å—Ö–µ–º–∞:

```
[–ó–≤–æ–Ω—è—â–∏–π] ‚Üí [RingCentral] ‚Üí [SIP Trunk] ‚Üí [–í–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π SIP —Å–µ—Ä–≤–µ—Ä] ‚Üí [–ù–µ–π—Ä–æ—Å–µ—Ç—å AI]
```

## –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã

### 1. –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ RingCentral

–£ –≤–∞—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–ª–∞–Ω–æ–≤:
- RingCentral Office
- RingCentral MVP
- –õ—é–±–æ–π –ø–ª–∞–Ω —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SIP trunking

### 2. –ù–∞ –≤–∞—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ

- **–ü—É–±–ª–∏—á–Ω—ã–π IP –∞–¥—Ä–µ—Å** –∏–ª–∏ **–ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤** –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ
- –û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:
  - 5060 (SIP) - –¥–ª—è —Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏–∏
  - 10000-20000 (RTP) - –¥–ª—è –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞

## –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –ü–æ–ª—É—á–µ–Ω–∏–µ SIP credentials –æ—Ç RingCentral

1. –í–æ–π–¥–∏—Ç–µ –≤ RingCentral Admin Portal
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Phone System** ‚Üí **Phones & Devices**
3. –ù–∞–∂–º–∏—Ç–µ **Add Device** ‚Üí **Other Phone** ‚Üí **SIP Phone**
4. –ü–æ–ª—É—á–∏—Ç–µ:
   - **SIP Domain** (–Ω–∞–ø—Ä–∏–º–µ—Ä, sip.ringcentral.com)
   - **Username** (–æ–±—ã—á–Ω–æ –≤–∞—à extension)
   - **Password** (SIP –ø–∞—Ä–æ–ª—å)
   - **Outbound Proxy** (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ (–µ—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ IP)

–ù–∞ –≤–∞—à–µ–º —Ä–æ—É—Ç–µ—Ä–µ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:
```
–í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 5060 ‚Üí –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP:5060 (UDP/TCP)
–í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 10000-20000 ‚Üí –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π IP:10000-20000 (UDP)
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ SIP —Å–µ—Ä–≤–µ—Ä–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
nano ringcentral_config.py
```

2. –î–æ–±–∞–≤—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```python
# RingCentral SIP –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
RINGCENTRAL_CONFIG = {
    'domain': 'sip.ringcentral.com',
    'username': '–≤–∞—à_extension',
    'password': '–≤–∞—à_sip_–ø–∞—Ä–æ–ª—å',
    'extension': '–≤–∞—à_–Ω–æ–º–µ—Ä_extension',
    'outbound_proxy': 'sip-ams.ringcentral.com',  # –∏–ª–∏ –¥—Ä—É–≥–æ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–≥–∏–æ–Ω–∞
    'transport': 'UDP',
    'register_interval': 300,  # —Å–µ–∫—É–Ω–¥
    'codec': 'PCMU',  # –∏–ª–∏ PCMA
}

# –õ–æ–∫–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
LOCAL_CONFIG = {
    'public_ip': '–≤–∞—à_–ø—É–±–ª–∏—á–Ω—ã–π_ip',  # –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–π IP —Ä–æ—É—Ç–µ—Ä–∞
    'local_ip': '0.0.0.0',  # —Å–ª—É—à–∞—Ç—å –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö
    'sip_port': 5060,
    'rtp_start_port': 10000,
    'rtp_end_port': 20000,
}
```

### –®–∞–≥ 4: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è SIP —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RingCentral

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª `ringcentral_sip_server.py`:

```python
#!/usr/bin/env python3
"""
SIP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å RingCentral
"""

import socket
import threading
import hashlib
import time
import re
from datetime import datetime
import logging
from sip_voice_ai_engine import VoiceAIEngine
from sip_speech_processor import SpeechProcessor
from ringcentral_config import RINGCENTRAL_CONFIG, LOCAL_CONFIG

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class RingCentralSIPServer:
    def __init__(self):
        self.config = RINGCENTRAL_CONFIG
        self.local_config = LOCAL_CONFIG
        self.ai_engine = VoiceAIEngine()
        self.speech_processor = SpeechProcessor()
        self.registered = False
        self.call_id_counter = 0
        
        # SIP socket
        self.sip_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.sip_socket.bind((self.local_config['local_ip'], self.local_config['sip_port']))
        
        logger.info(f"üöÄ RingCentral SIP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É {self.local_config['sip_port']}")
        
    def register_with_ringcentral(self):
        """–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ RingCentral SIP —Å–µ—Ä–≤–µ—Ä–µ"""
        register_request = self.build_register_request()
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º REGISTER –∑–∞–ø—Ä–æ—Å
        server_addr = (self.config['domain'], 5060)
        self.sip_socket.sendto(register_request.encode(), server_addr)
        
        logger.info(f"üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω REGISTER –∑–∞–ø—Ä–æ—Å –Ω–∞ {self.config['domain']}")
        
    def build_register_request(self):
        """–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ SIP REGISTER –∑–∞–ø—Ä–æ—Å–∞"""
        from_uri = f"sip:{self.config['username']}@{self.config['domain']}"
        to_uri = from_uri
        contact_uri = f"sip:{self.config['username']}@{self.local_config['public_ip']}:{self.local_config['sip_port']}"
        call_id = f"{int(time.time())}@{self.local_config['public_ip']}"
        
        request = f"REGISTER sip:{self.config['domain']} SIP/2.0\\r\\n"
        request += f"Via: SIP/2.0/UDP {self.local_config['public_ip']}:{self.local_config['sip_port']};branch=z9hG4bK{int(time.time())}\\r\\n"
        request += f"From: {from_uri};tag={int(time.time())}\\r\\n"
        request += f"To: {to_uri}\\r\\n"
        request += f"Call-ID: {call_id}\\r\\n"
        request += f"CSeq: 1 REGISTER\\r\\n"
        request += f"Contact: {contact_uri}\\r\\n"
        request += f"Expires: {self.config['register_interval']}\\r\\n"
        request += f"User-Agent: VoiceAI/1.0\\r\\n"
        request += f"Content-Length: 0\\r\\n"
        request += "\\r\\n"
        
        return request
        
    def run(self):
        """–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞"""
        # –°–Ω–∞—á–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è
        self.register_with_ringcentral()
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Ç–æ–∫ –¥–ª—è –ø–µ—Ä–µregist—Ä–∞—Ü–∏–∏
        threading.Thread(target=self.registration_loop, daemon=True).start()
        
        # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
        while True:
            try:
                data, addr = self.sip_socket.recvfrom(65535)
                message = data.decode('utf-8')
                threading.Thread(target=self.handle_sip_message, args=(message, addr)).start()
            except Exception as e:
                logger.error(f"–û—à–∏–±–∫–∞: {e}")

    def registration_loop(self):
        """–¶–∏–∫–ª –ø–µ—Ä–µregist—Ä–∞—Ü–∏–∏"""
        while True:
            time.sleep(self.config['register_interval'] - 30)  # –ó–∞ 30 —Å–µ–∫—É–Ω–¥ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
            self.register_with_ringcentral()
            
    def handle_sip_message(self, message, addr):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö SIP —Å–æ–æ–±—â–µ–Ω–∏–π"""
        lines = message.split('\\r\\n')
        if not lines:
            return
            
        first_line = lines[0]
        
        if first_line.startswith('INVITE'):
            logger.info("üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫!")
            self.handle_invite(message, addr)
        elif first_line.startswith('SIP/2.0 200 OK'):
            logger.info("‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ RingCentral")
            self.registered = True
        elif first_line.startswith('SIP/2.0 401'):
            logger.info("üîê –¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è")
            self.handle_auth_challenge(message, addr)

if __name__ == "__main__":
    server = RingCentralSIPServer()
    server.run()
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤ RingCentral

1. –í RingCentral Admin Portal –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Call Handling & Forwarding**
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏:
   - **Forward to**: Other Phone
   - **Number**: sip:ai@–≤–∞—à_–ø—É–±–ª–∏—á–Ω—ã–π_ip:5060
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Simultaneous Ring** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞

### –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ó–∞–ø—É—Å–∫ Ollama (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
ollama serve

# –ó–∞–ø—É—Å–∫ SIP —Å–µ—Ä–≤–µ—Ä–∞
python3 ringcentral_sip_server.py
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
‚úÖ –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ RingCentral
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫
–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à RingCentral –Ω–æ–º–µ—Ä. –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üìû –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫!
üé§ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ...
ü§ñ AI –æ—Ç–≤–µ—Ç: ...
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "–ù–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–∞ RingCentral"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å SIP credentials
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã –æ—Ç–∫—Ä—ã—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall

### "–ó–≤–æ–Ω–∫–∏ –Ω–µ –¥–æ—Ö–æ–¥—è—Ç"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –≤ RingCentral
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π IP
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ NAT –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### "–ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞"
- –£–≤–µ–ª–∏—á—å—Ç–µ –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–¥–µ–∫ G.711 (PCMU/PCMA)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —á–µ—Ä–µ–∑ RingCentral API

–ï—Å–ª–∏ –ø—Ä—è–º–∞—è SIP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–ª–æ–∂–Ω–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
1. **WebRTC SDK** - –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
2. **Call Control API** - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞–º–∏ —á–µ—Ä–µ–∑ REST API
3. **RingCentral Softphone SDK** - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ—Ñ—Ç—Ñ–æ–Ω–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN –∏–ª–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –ø–æ IP –≤ firewall
- –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ SIP –ø–∞—Ä–æ–ª–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏