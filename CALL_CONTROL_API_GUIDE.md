# RingCentral Call Control API Integration Guide

## üéØ –û–±–∑–æ—Ä —Ä–µ—à–µ–Ω–∏—è

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–µ–º–∞ –∑–≤–æ–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ RingCentral —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Call Control API –∏ WebRTC –¥–ª—è real-time audio streaming.

## üìã –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–µ–º –∑–≤–æ–Ω–∫–æ–≤ (–†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

**–§–∞–π–ª**: `webhook_server.py`

- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `_handle_telephony_session()` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –∑–≤–æ–Ω–∫–æ–≤ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "Ringing"
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `answer_call_automatically()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ Call Control API
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `start_ai_conversation()` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ AI –¥–∏–∞–ª–æ–≥–∞

### 2. ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ TTS –≤ –∑–≤–æ–Ω–∫–µ (–†–ï–ê–õ–ò–ó–û–í–ê–ù–û)

**–§–∞–π–ª**: `webhook_server.py`

- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `play_audio_to_call()` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `ringcentral_auth.py` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

### 3. üöß WebRTC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ë–ê–ó–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê)

**–§–∞–π–ª**: `webrtc_integration.py` (–Ω–æ–≤—ã–π)

- –°–æ–∑–¥–∞–Ω WebRTCManager –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è real-time audio —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ audio streaming
- –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –±–∞–∑–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å RingCentral WebRTC API

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞:

1. **Webhook –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ** –æ –≤—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–≤–æ–Ω–∫–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "Ringing"
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç** —á–µ—Ä–µ–∑ Call Control API
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è** —á–µ—Ä–µ–∑ TTS
5. **–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∞—É–¥–∏–æ** –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–≤–æ–Ω–∫–µ
6. **WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (TODO) –¥–ª—è real-time –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –∑–≤–æ–Ω–æ–∫:

```python
# –í webhook_server.py
def answer_call_automatically(session_id, party_id, caller_info):
    response = make_request(
        'POST',
        f'/restapi/v1.0/account/~/extension/~/telephony/sessions/{session_id}/parties/{party_id}/answer'
    )
    return True
```

### –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ TTS –≤ –∑–≤–æ–Ω–∫–µ:

```python
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ
audio_data = await async_synthesize("–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.")

# –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤ –∑–≤–æ–Ω–∫–µ
play_audio_to_call(session_id, party_id, audio_data)
```

### WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è):

```python
# –°–æ–∑–¥–∞–Ω–∏–µ WebRTC —Å–µ—Å—Å–∏–∏
from webrtc_integration import setup_webrtc_for_call

webrtc_session_id = await setup_webrtc_for_call(telephony_session_id, party_id)

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ
send_audio_to_webrtc(webrtc_session_id, audio_data)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∞—É–¥–∏–æ
incoming_audio = get_audio_from_webrtc(webrtc_session_id)
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Media API**: RingCentral –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
2. **WebRTC**: –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã
3. **Latency**: –í–æ–∑–º–æ–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ Media API

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–≤–æ–Ω–∫–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ TTS –∞—É–¥–∏–æ
- [ ] –ò–∑–º–µ—Ä–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: WebRTC –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ò–∑—É—á–∏—Ç—å RingCentral WebRTC API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–µ WebRTC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Ö–æ–¥—è—â–µ–≥–æ –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –£–ª—É—á—à–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ TTS –¥–ª—è —á–∞—Å—Ç—ã—Ö —Ñ—Ä–∞–∑
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [RingCentral Call Control API](https://developers.ringcentral.com/api-reference/Call-Control/answerCallParty)
- [RingCentral WebRTC Guide](https://developers.ringcentral.com/guide/voice/webrtc)
- [RingCentral Media API](https://developers.ringcentral.com/api-reference/Media/uploadMedia)

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
```bash
# –°–ª–µ–¥–∏—Ç—å –∑–∞ webhook —Å–æ–±—ã—Ç–∏—è–º–∏
tail -f webhook.log | grep "telephony/sessions"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–∞
tail -f webhook.log | grep -E "(Ringing|answer_call|‚úÖ|‚ùå)"

# WebRTC —Å–æ–±—ã—Ç–∏—è
tail -f webhook.log | grep "WebRTC"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook –ø–æ–¥–ø–∏—Å–∫—É
python check_webhook_status.py

# –¢–µ—Å—Ç TTS
python test_voices.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
python check_jwt_expiry.py
```