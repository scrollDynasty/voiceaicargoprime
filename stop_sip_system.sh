#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ SIP/RTP Voice AI —Å–∏—Å—Ç–µ–º—ã

echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ SIP/RTP Voice AI —Å–∏—Å—Ç–µ–º—ã"
echo "===================================="

# –§—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
stop_process() {
    local pid_file=$1
    local name=$2
    
    if [ -f "$pid_file" ]; then
        PID=$(cat "$pid_file")
        if kill -0 $PID 2>/dev/null; then
            echo "‚èπÔ∏è  –û—Å—Ç–∞–Ω–æ–≤–∫–∞ $name (PID: $PID)..."
            kill $PID
            sleep 1
            
            # –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º SIGKILL
            if kill -0 $PID 2>/dev/null; then
                echo "‚ö†Ô∏è  –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ $name..."
                kill -9 $PID
            fi
            
            rm -f "$pid_file"
            echo "‚úÖ $name –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        else
            echo "‚ÑπÔ∏è  $name –Ω–µ –∑–∞–ø—É—â–µ–Ω (PID $PID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)"
            rm -f "$pid_file"
        fi
    else
        echo "‚ÑπÔ∏è  $name –Ω–µ –∑–∞–ø—É—â–µ–Ω (PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω)"
    fi
}

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ SIP —Å–µ—Ä–≤–µ—Ä–∞
stop_process "logs/sip_server.pid" "SIP —Å–µ—Ä–≤–µ—Ä"

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
rm -f temp/*.tmp

echo ""
echo "===================================="
echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"
echo "===================================="